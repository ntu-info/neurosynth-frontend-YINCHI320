<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AJAX Frontend Demo - Final</title>
  <script src="https://cdn.tailwindcss.com"></script> 
</head>
<body class="bg-gray-50 p-8 font-sans">
  <div class="max-w-4xl mx-auto bg-white shadow-2xl rounded-xl p-8 space-y-10">
    <header class="text-center pb-4 border-b">
        <h1 class="text-4xl font-extrabold text-indigo-700">ğŸ§  Backend AJAX Frontend</h1>
        <p class="text-gray-500 mt-2">Connecting to: https://mil.psy.ntu.edu.tw:5000</p>
    </header>

    <section>
        <h2 class="text-2xl font-bold mb-4 text-indigo-600">1. æŸ¥è©¢æ‰€æœ‰è©å½™ï¼š`/terms`</h2>
        <div class="flex items-center space-x-4 mb-4">
            <button id="btnFetchTerms" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-150 ease-in-out shadow-md">
                ç²å–æ‰€æœ‰è©å½™
            </button>
        </div>
        <pre id="outAllTerms" class="bg-gray-100 text-gray-700 p-4 rounded-lg overflow-auto text-sm min-h-[50px] max-h-96">...</pre>
    </section>

    <section>
        <h2 class="text-2xl font-bold mb-4 text-indigo-600">2. æŸ¥è©¢ç‰¹å®šè©å½™ç›¸é—œé …ï¼š`/terms/<t1>` (å³æ™‚ AJAX)</h2>
        <div class="flex space-x-4 mb-4">
            <input type="text" id="termInput" placeholder="è¼¸å…¥è©å½™ï¼Œä¾‹å¦‚: amygdala" class="flex-grow border-gray-300 border p-2 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" value="amygdala">
            </div>
        <pre id="outTermQuery" class="bg-gray-100 text-gray-700 p-4 rounded-lg overflow-auto text-sm min-h-[50px] max-h-96">è«‹åœ¨ä¸Šæ–¹è¼¸å…¥è©å½™ä»¥æŸ¥è©¢ã€‚</pre>
    </section>

    <section>
        <h2 class="text-2xl font-bold mb-4 text-indigo-600">3. åŸ·è¡Œé‚è¼¯æŸ¥è©¢ï¼š`/query/<q_string>/studies` (å³æ™‚ AJAX)</h2>
        <div class="mb-2 text-sm text-gray-500">ç¯„ä¾‹ï¼š`amygdala not emotion`ï¼Œ**è«‹ç”¨ç©ºæ ¼åˆ†éš”**ã€‚</div>
        <div class="flex space-x-4 mb-4">
            <input type="text" id="queryString" placeholder="è¼¸å…¥æŸ¥è©¢å­—ä¸²ï¼Œä¾‹å¦‚: hippocampus and memory" class="flex-grow border-gray-300 border p-2 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" value="amygdala not emotion">
            </div>
        <pre id="outLogicQuery" class="bg-gray-100 text-gray-700 p-4 rounded-lg overflow-auto text-sm min-h-[50px] max-h-96">è«‹åœ¨ä¸Šæ–¹è¼¸å…¥æŸ¥è©¢å­—ä¸²ã€‚</pre>
    </section>
    
  </div>

  <script>
    // ğŸ’¥ ä¿®æ”¹ 5: å®šç¾©åŸºç¤ URLï¼Œæ–¹ä¾¿ç¶­è­· ğŸ’¥
    const API_BASE = 'https://mil.psy.ntu.edu.tw:5000';

    /**
     * ğŸ’¥ ä¿®æ”¹ 6: å»ºç«‹é€šç”¨çš„ Fetch å‡½å¼ï¼Œè™•ç†æ‰€æœ‰ API å‘¼å«çš„é‚è¼¯ ğŸ’¥
     * @param {string} url - å®Œæ•´çš„ API URL
     * @param {HTMLElement} outputElement - é¡¯ç¤ºçµæœçš„ <pre> å…ƒç´ 
     */
    async function executeFetch(url, outputElement) {
        outputElement.textContent = 'Requesting...';
        
        // éŒ¯èª¤è™•ç†å‡½å¼ï¼Œç¢ºä¿åœ¨éŒ¯èª¤æ™‚é¡¯ç¤ºç´…è‰²æç¤º
        const handleError = (err) => {
            outputElement.textContent = 
                `Error: ${err && err.message ? err.message : String(err)}\n\n` +
                `Common causes:\n1) CORS not allowed by the server\n2) Running without a local server\n3) Network/server issues`;
            outputElement.classList.remove('text-green-400', 'bg-gray-800');
            outputElement.classList.add('text-red-500', 'bg-red-50');
        };

        try {
            const resp = await fetch(url);
            let info = `[API Call Success] HTTP ${resp.status} ${resp.statusText}\n`;
            
            outputElement.classList.remove('text-red-500', 'bg-red-50'); // æ¸…é™¤éŒ¯èª¤æ¨£å¼

            if (!resp.ok) {
                const text = await resp.text();
                outputElement.textContent = info + '\n' + text;
                return;
            }

            const ct = resp.headers.get('content-type') || '';
            if (ct.includes('application/json')) {
                const data = await resp.json();
                outputElement.textContent = info + '\n' + JSON.stringify(data, null, 2);
            } else {
                const text = await resp.text();
                outputElement.textContent = info + '\n' + text;
            }
        } catch (err) {
            handleError(err);
        }
    }

    // 1. æŸ¥è©¢æ‰€æœ‰è©å½™ï¼š/terms (é»æ“ŠæŒ‰éˆ•è§¸ç™¼)
    async function fetchAllTerms() {
        const out = document.getElementById('outAllTerms');
        // ç¢ºä¿ /terms è¼¸å‡ºä½¿ç”¨ç‰¹æ®Šçš„æ·±è‰²æ¨£å¼
        // out.classList.add('text-green-400', 'bg-gray-800'); 
        await executeFetch(`${API_BASE}/terms`, out);
    }

    // 2. æŸ¥è©¢ç‰¹å®šè©å½™ç›¸é—œé …ï¼š/terms/<t1> (è¼¸å…¥å³æ™‚è§¸ç™¼)
    async function fetchTermQuery() {
        const term = document.getElementById('termInput').value.trim();
        const out = document.getElementById('outTermQuery');
        out.classList.remove('text-green-400', 'bg-gray-800'); // ä½¿ç”¨ä¸€èˆ¬æ¨£å¼

        if (!term) {
            out.textContent = "è«‹è¼¸å…¥ä¸€å€‹è©å½™ (e.g., amygdala) ä»¥å³æ™‚æŸ¥è©¢ã€‚";
            return;
        }

        const url = `${API_BASE}/terms/${encodeURIComponent(term)}`;
        await executeFetch(url, out);
    }

    // 3. åŸ·è¡Œé‚è¼¯æŸ¥è©¢ï¼š/query/<q_string>/studies (è¼¸å…¥å³æ™‚è§¸ç™¼)
    async function fetchLogicQuery() {
        const query = document.getElementById('queryString').value.trim();
        const out = document.getElementById('outLogicQuery');
        out.classList.remove('text-green-400', 'bg-gray-800'); // ä½¿ç”¨ä¸€èˆ¬æ¨£å¼

        if (!query) {
            out.textContent = "è«‹è¼¸å…¥ä¸€å€‹é‚è¼¯æŸ¥è©¢å­—ä¸² (e.g., hippocampus and memory) ä»¥å³æ™‚æŸ¥è©¢ã€‚";
            return;
        }

        // å¿…é ˆå°æŸ¥è©¢å­—ä¸²é€²è¡Œç·¨ç¢¼ (ä¾‹å¦‚å°‡ç©ºæ ¼è½‰ç‚º %20)
        const url = `${API_BASE}/query/${encodeURIComponent(query)}/studies`;
        await executeFetch(url, out);
    }

    // ğŸ’¥ ä¿®æ”¹ 7: ç¶å®šäº‹ä»¶ç›£è½å™¨ - å¯¦ç¾å³æ™‚æœç´¢ ğŸ’¥
    document.addEventListener('DOMContentLoaded', () => {
        // 1. /terms ä»ç”±æŒ‰éˆ•è§¸ç™¼
        document.getElementById('btnFetchTerms').addEventListener('click', fetchAllTerms);
        
        // 2. /terms/<t1> æ”¹ç‚ºç›£è½è¼¸å…¥æ¡†çš„ 'input' äº‹ä»¶ (å³æ™‚æœç´¢)
        document.getElementById('termInput').addEventListener('input', fetchTermQuery);
        
        // 3. /query/.../studies æ”¹ç‚ºç›£è½è¼¸å…¥æ¡†çš„ 'input' äº‹ä»¶ (å³æ™‚æœç´¢)
        document.getElementById('queryString').addEventListener('input', fetchLogicQuery);

        // é é¢è¼‰å…¥æ™‚ï¼Œè‡ªå‹•åŸ·è¡Œ /terms å’Œå…©æ¬¡å³æ™‚æŸ¥è©¢ (ä½¿ç”¨é è¨­å€¼)
        fetchAllTerms();
        fetchTermQuery(); // ç«‹å³æŸ¥è©¢é è¨­çš„ 'amygdala'
        fetchLogicQuery(); // ç«‹å³æŸ¥è©¢é è¨­çš„ 'amygdala not emotion'
    });

    
  </script>
</body>
</html>

